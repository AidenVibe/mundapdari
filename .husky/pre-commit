#!/usr/bin/env sh
# 극한 성능 최적화: 0.1초 타겟

# 5개 파일 미만일 때만 검사 (대부분의 작은 커밋)
CHANGED_FILES=$(git diff --cached --name-only | wc -l)
if [ $CHANGED_FILES -gt 5 ]; then
  echo "⚡ 대용량 커밋 감지: 빠른 커밋 모드 (검사 스킵)"
  exit 0
fi

# 필수 보안 검사만 (0.1초 이내)
timeout 0.2s sh -c 'git diff --cached --name-only | grep -E "\.(env|key|pem|crt)$" && echo "⚠️ 민감 파일 감지!" && exit 1 || exit 0' || true

# JS/TS 파일만 최소 문법 검사 (병렬 실행)
git diff --cached --name-only | grep -E "\.(js|ts|tsx|jsx)$" | head -3 | xargs -P 4 -I {} sh -c 'node -c {} 2>/dev/null || echo "문법 오류: {}"' || true

echo "✅ 빠른 커밋 완료"